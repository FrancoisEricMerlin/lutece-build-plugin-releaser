<!-- TO REMOVE WHEN feature_frameset.html will be correctly added to this template -->
<section class="content-header">
    <h1>
        <a href="jsp/admin/plugins/releaser/ManageClusters.jsp" title="Release de sites et de clusters">Release de sites et de clusters</a>
        <small class="hidden-xs hidden-sm">Release en cours</small>
    </h1>
    <ol class="breadcrumb applications">
    </ol>
</section>
<section class="content ">
<!-- EN TO REMOVE -->
<div class="app-wrapper">
  <div class="row">
    <div class="col-xs-12 col-sm-12">
      <div class="info-box info-box-release">
        <span class="info-box-icon bg-aqua"><i class="fa fa-cube"></i></span>
        <div class="info-box-content">
          <div class="col-xs-7 col-sm-10">
            <span class="info-box-text">
              ${site.name} [${site.artifactId !''}-${site.version!''}]
             </span>
            <span class="info-box-number">${site.description}</span>
          </div>
          <div class="col-xs-4 col-sm-2">
          <a type="button" class="btn btn-success btn-lg btn-block" href="jsp/admin/plugins/releaser/ManageSiteRelease.jsp?id_site=${site.id}">
            <span class="fa fa-cogs"></span>  Retour au <#if !site.theme>Site<#else>Theme</#if>
          </a>
          <#if !site.theme>
          <a type="button" id="deploy_site_release-${site.artifactId !''}" style="display:none" class="button transition border-blue small btn-release-history"  href="jsp/admin/plugins/deployment/ManageApplication.jsp?search_name=${site.scmUrl?replace("/trunk/","")?replace("/trunk","")!''}">
            <span class="fa fa-cogs"></span>  D&eacute;ployer la version releas&eacute;e Site
          </a>
         </#if>
          
        </div>
        </div>
      </div>
    </div>
  </div>
  <div class="row">
    <div class="col-md-12 col-sm-12 col-xs-12">
      <div class="info-box info-box-release components">
        <span class="info-box-icon bg-teal"><i class="fa fa-sitemap"></i></span>
        <div class="info-box-content">
          <span class="info-box-text">Release du <#if !site.theme>Site<#else>Theme</#if></span>
        </div>
      </div>
      <ul class="list-group list-components fa-padding">
        <li class="list-group-item">
          <div class="media">
            <div class="media-left"></div>
            <div class="media-body">
            <p>
              <span class="artifact up">
                ${site.artifactId!}
                <strong class="button transition fill-lightblue small">${site.nextReleaseVersion!}</strong>
              </span>
              <span id="release-result-${site.artifactId!}"></span>
              <a id="histo-${site.artifactId!}" class="button transition border-blue small btn-release-history"  title="Visuliser l'historique des releases" href='jsp/admin/plugins/releaser/ManageSiteRelease.jsp?view=releaseComponentHistory&artifact_id=${site.artifactId!}' target="_blank" >
                <i class="fa fa-cog fa-fw"></i> Visualiser l'historique des releases
              </a>
            </p>
            <div id="progress-wrapper-${site.artifactId!}" data-artifactid="${site.artifactId!}" data-context_release_id="${release_ctx_result[site.artifactId!]!}" class="progress-wrapper clearfix">
              <div class="progress active pull-left ">
                <div class="progress-bar progress-bar-success progress-bar-striped" role="progressbar" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100" style="width: 0%">
                  <span class="sr-only">0% Complete</span>
                </div>
              </div>
              <div class="pull-left">
                <button href="#" data-toggle="modal"   data-artifactid="${site.artifactId!}" data-context_release_id="${release_ctx_result[site.artifactId!]!}" id="view_log_btn_${site.artifactId!}"  data-target="#modalLogs" data-context_release_id="" class="view_log_btn button transition small fill-whitish-black">
                  Voir les logs
                </button>
              </div>
            </div>
          </div>
        </div>
      </li>
    </ul>
  </div>
</div>
<div class="row">
  <div class="col-md-12 col-sm-12 col-xs-12">
    <div class="info-box info-box-release components">
      <span class="info-box-icon bg-yellow"><i class="fa fa-puzzle-piece"></i></span>
      <div class="info-box-content">
        <span class="info-box-text">Release de composants projet</span>
      </div>
    </div>
    <ul class="list-group list-components fa-padding">
      <#list site.components as component>
        <#if component.project && component.isSnapshotVersion() && !component.downgrade>
          <li class="list-group-item">
            <div class="media">
              <div class="media-left"></div>
              <div class="media-body">
                <p>
                  <span class="artifact up">
                    ${component.artifactId!}
                    <strong class="button transition fill-lightblue small">${component.targetVersion}</strong>
                  </span>
                  <span id="release-result-${component.artifactId!}"></span>
                  <a id="histo-${component.artifactId!}" class="button transition border-blue small btn-release-history"  title="Visuliser l'historique des releases" href='jsp/admin/plugins/releaser/ManageSiteRelease.jsp?view=releaseComponentHistory&artifact_id=${component.artifactId}' target="_blank" >
                    <i class="fa fa-cog fa-fw"></i> Visualiser l'historique des releases
                  </a>
                </p>
                <#if component.shouldBeReleased()>
                    <div id="progress-wrapper-${component.artifactId!}" data-artifactid="${component.artifactId!}" data-context_release_id="${release_ctx_result[component.artifactId!]!}" class="progress-wrapper clearfix">
                      <div class="progress active pull-left ">
                        <div class="progress-bar progress-bar-success progress-bar-striped" role="progressbar" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100" style="width: 0%">
                          <span class="sr-only">0% Complete</span>
                        </div>
                      </div>
                      <div class="pull-left">
                        <button href="#" data-toggle="modal"   data-artifactid="${component.artifactId!}" data-context_release_id="${release_ctx_result[component.artifactId!]!}" id="view_log_btn_${component.artifactId!}"  data-target="#modalLogs" data-context_release_id="" class="view_log_btn button transition small fill-whitish-black">
                          Voir les logs
                        </button>
                      </div>
                    </div>
                 </#if>   
              </div>
            </div>
          </li>
        </#if>
      </#list>
    </ul>
    </div>
  </div>
</div>
</section>

<div class="modal fade" id="modalLogs" tabindex="-1" role="dialog" aria-labelledby="modalLogsLabel">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="modalLogsLabel">Release - Logs</h4>
      </div>
      <div class="modal-body">
                <pre id="console_wf_log"></pre>
            </div>
            <div class="modal-footer">
                <button type="button" class="button transition small fill-whitish-black" data-dismiss="modal">Fermer</button>
        </div>
        </div>
    </div>
</div>
<script src="js/plugins/releaser/notify.min.js" type="text/javascript"></script>
<script src="js/plugins/releaser/releaser.js" type="text/javascript"></script>
<script>
var artifactIdInProgress;
$(function() {
    $( ".progress-wrapper" ).each(function( index ) {
    callReleaseInfo( $(this).attr("data-context_release_id"),"#progress-wrapper-" + $(this).attr("data-artifactid"),$(this).attr("data-artifactid"))
  });
    $(".view_log_btn").click( function(e){
        $("#console_wf_log").html(" ");
        var artifactId=$(this).attr("data-artifactid");
        var contextId=$(this).attr("data-context_release_id");
        artifactIdInProgress=artifactId;
        var progressId="#progress-wrapper-" + artifactId;
        callReleaseInfo( contextId,progressId,artifactId)
       }
    );
});
</script>


